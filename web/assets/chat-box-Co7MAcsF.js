import{r as h,j as i}from"./index-x4Ro_lB7.js";import{S as b}from"./Spinner-BKjtYmKp.js";let d;function j({auth:a,setHeight:s,activeChatId:t,chatRef:r,worldMode:n,appId:l}){const u=h.useRef(),o=h.useRef();return d=t,h.useEffect(()=>{const e=u.current.getBoundingClientRect();e.bottom-e.top,s(e.bottom-e.top+8)},[s]),i.jsxs("div",{ref:u,className:"input-group pb-4 fixed-bottom",style:{backgroundColor:"white"},children:[i.jsx("input",{type:"text",className:"form-control",placeholder:"What's Gleaning?",onKeyUp:e=>{const g=e.key,m=e.currentTarget.value;g==="Enter"&&(y(a,m,{isWorld:n,chatRef:r,spinnerRef:o,appId:l}),e.currentTarget.value="")}}),i.jsx("button",{className:"btn border d-none",ref:o,type:"button",children:i.jsx(b,{animation:"border",variant:"primary"})}),i.jsx("button",{className:" input-group-text btn btn-primary",type:"button",children:"Send"})]})}async function y(a,s,t){t.spinnerRef.current.classList.remove("d-none");let r=!1;d||(r=!0);const n=N(s,d,t.isWorld,t.appId),l={method:"POST",body:JSON.stringify(n),headers:{"content-type":"application/json",Authorization:`${a.token}`,"x-api-host":a.backendURL}};t.chatRef.current.addMessage(n),r=!1,t.chatRef.current.clearFollowUpPrompts(n);const u=await fetch("/api/chat",l);let o=[],e;for await(const g of u.body){let f=new TextDecoder().decode(g);if(f=f.trim(),f){const x=f.split(`
`);e&&(x.unshift(e),e=void 0);for(const p of x)try{const c=JSON.parse(p);d=(c==null?void 0:c.chatId)??d,r?t.chatRef.current.startNewChat(c):t.chatRef.current.addMessage(c)}catch{o.push(p),e=R(o),e!==void 0?(o.length=0,console.log("Fixed",e)):console.log(p)}}}e&&(console.log("Pending Message",e),t.chatRef.current.addMessage(JSON.parse(e)),e=void 0),t.spinnerRef.current.classList.add("d-none")}function R(a){const s=a.join("");try{return JSON.parse(s),s}catch{return}}function N(a,s,t,r){const n={saveChat:!0,stream:!0,messages:[{author:"USER",fragments:[{text:a}],messageType:"CONTENT"}]};return t&&(n.actionHints=["Gemini Web Search"],n.agentConfig={agent:"GPT"}),s&&(n.chatId=s),r&&(n.applicationId=r),n}export{j as default};
