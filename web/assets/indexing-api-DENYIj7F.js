import{r as f,a as x,u as y,j as e,C as g,F as l,d as w,e as h,B as R}from"./index-x4Ro_lB7.js";import{A as S}from"./index-C4a4bbUT.js";import b from"./file-row-B2AkusEk.js";import{M as F}from"./index-Bl1zCG_a.js";import"./Modal-Dd_ICExf.js";import"./TransitionWrapper-WYXf0dFm.js";import"./objectWithoutPropertiesLoose-Dsqj8S3w.js";import"./querySelectorAll-C-tQz4TH.js";import"./index.modern--LruQv1w.js";import"./ListGroup-Bbqz-IgS.js";import"./hook-BLte72Pb.js";function G({ref:s}){const t=f.useRef(null),n=x(r=>r.indexing),a=y(),o=n.files,p=n.dataSources,i=x(r=>r.auth);C(i);const m=f.useRef(),j=e.jsx("p",{children:"Select the object type you want to add the file as - "});return e.jsxs(g,{fluid:!0,children:[e.jsx(l.Group,{className:"mb-3",children:e.jsx(l.Control,{type:"text",placeholder:"Enter the Datasource Name / ID",onChange:function(r){a(w(r.currentTarget.value.split(",")))},value:p})}),e.jsxs(l.Group,{className:"mb-3",children:[e.jsxs(l.Label,{children:["Files to Index - Supported formats are ",e.jsx(F,{children:"`application/pdf, text/plain, text/html, text/csv`"})]}),e.jsx(l.Control,{type:"file",multiple:!0,ref:t,accept:"application/pdf,text/plain,text/html,text/csv",onChange:function(r){const c=r.currentTarget.files;D(c).then(u=>{a(h(u))})}})]}),e.jsxs(e.Fragment,{children:[o.length>0&&j,o.length>0&&o.map(r=>e.jsx(b,{file:r,updateObject:(c,u)=>{a(h(o.map(d=>u?{...d,...c}:d.name===c.name?{...c}:d)))}},r.name))]}),e.jsx(R,{className:"mt-2",style:{width:"100%",letterSpacing:"8px"},as:"input",type:"button",value:"INDEX",onClick:async()=>{await k(i,p,o,m)}}),e.jsx(S,{alertRef:m})]})}function C(s){return!!(s.token&&s.emailAddress&&s.backendURL)}async function D(s){const t=[];for(const n of s){const a={name:n.name,size:n.size,type:n.type,gleanObjectType:"",content:await N(n)};t.push(a)}return t}function N(s){const t=new FileReader;return new Promise((n,a)=>{t.onloadend=()=>{n(t.result.split(";")[1].split(",")[1])},t.onerror=()=>{n(t.error)},t.readAsDataURL(s)})}async function k(s,t,n,a){const o={dataSources:t,files:n},p=await fetch("/api/index",{headers:{authorization:`${s.token}`,"x-api-host":s.backendURL,"content-type":"application/json"},method:"post",credentials:"include",body:JSON.stringify(o)});try{const i=await p.json();a.current.setData(i),a.current.setTitle("Index Status"),a.current.handleShow()}catch(i){console.log(i)}}export{G as default};
